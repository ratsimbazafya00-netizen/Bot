#!/usr/bin/env python3
# =========================================================
# SmmKingdom Auto FINAL – STABLE & AUDITED (2026)
# IG Like & Follow AUTO | Commentaire MANUEL
# JSON CONFIG SAVE
# =========================================================

import asyncio
import os
import json
import time
import platform
import random
import re
from telethon import TelegramClient, events
from instagrapi import Client

# ================= FILES =================
TG_CONFIG_FILE = "config_telegram.json"
IG_ACCOUNTS_FILE = "accounts_instagram.json"
SESSION_DIR = "sessions"
BOT = "SmmKingdomTasksBot"

# ================= CONSOLE =================
os.system("")

def clear():
    os.system("cls" if platform.system().lower().startswith("win") else "clear")

# ================= COLORS =================
class C:
    RESET="\033[0m"
    RED="\033[31m"
    GREEN="\033[32m"
    YELLOW="\033[33m"
    CYAN="\033[36m"
    BOLD="\033[1m"

def log(msg, color=C.RESET):
    print(f"{color}{msg}{C.RESET}")

# ================= LOAD / SAVE =================
def load_json(path, default):
    if os.path.exists(path):
        with open(path, "r", encoding="utf-8") as f:
            return json.load(f)
    return default

def save_json(path, data):
    with open(path, "w", encoding="utf-8") as f:
        json.dump(data, f, indent=4)

# ================= DATA =================
tg_config = load_json(TG_CONFIG_FILE, {"API_ID": None, "API_HASH": "", "PHONE": ""})
IG_ACCOUNTS = load_json(IG_ACCOUNTS_FILE, [])

# ================= STATE =================
tg = None
ig_clients = {}
ig_index = 0
task_count = 0
manual_comment = False
task_lock = asyncio.Lock()

# ================= SMM WATCHDOG =================
LAST_SENT_CMD = None
LAST_SENT_TIME = 0
WAITING_SMM_RESPONSE = False

SMM_TIMEOUT = 120     # 2 minutes
MAX_RETRY = 3
CURRENT_RETRY = 0


# ================= TASK FILTER =================
TASK_LIKE = False
TASK_FOLLOW = False
TASK_COMMENT = False


TASK_LIMIT = 15
HUMAN_DELAY = (2.5, 4.5)
NO_TASK_DELAY = 3
COMPLETED_TEXT = "✅Completed"
SKIP_TEXT = "❌Skip"

# ================= MENUS =================
def banner():
    clear()
    log("╔══════════════════════════════════════════════════╗", C.CYAN)
    log("║                                                  ║", C.CYAN)
    log("║         ███████╗███╗   ███╗███╗   ███╗           ║", C.CYAN)
    log("║         ██╔════╝████╗ ████║████╗ ████║           ║", C.CYAN)
    log("║         ███████╗██╔████╔██║██╔████╔██║           ║", C.CYAN)
    log("║         ╚════██║██║╚██╔╝██║██║╚██╔╝██║           ║", C.CYAN)
    log("║         ███████║██║ ╚═╝ ██║██║ ╚═╝ ██║           ║", C.CYAN)
    log("║         ╚══════╝╚═╝     ╚═╝╚═╝     ╚═╝           ║", C.CYAN)
    log("║                                                  ║", C.CYAN)
    log("║        SMMKINGDOM • TASK AUTOMATION              ║", C.CYAN)
    log("║   Instagram Marketing • Telegram Control         ║", C.CYAN)
    log("║         By jabaly  +261 34 12 942 03             ║", C.CYAN)
    log("║   🔐 Licence Active    | ⚡ Stable Build         ║", C.CYAN)
    log("║   🌍 Windows / Termux  |  © 2026 SMMKINGDOM      ║", C.CYAN)
    log("║       'Herikerika mahatondradrano'               ║", C.CYAN)
    log("╚══════════════════════════════════════════════════╝", C.CYAN)


def main_menu():
    clear()
    banner()
    log("\n1️⃣ Config Telegram", C.YELLOW)
    log("2️⃣ Gestion comptes Instagram", C.YELLOW)
    log("3️⃣ Start Bot", C.GREEN)
    log("0️⃣ Quitter", C.RED)
    return input("👉 Choix : ").strip()

def telegram_menu():
    try:
        tg_config["API_ID"] = int(input("API_ID : "))
        tg_config["API_HASH"] = input("API_HASH : ").strip()
        tg_config["PHONE"] = input("PHONE (+261..) : ").strip()
        save_json(TG_CONFIG_FILE, tg_config)
        log("✔ Telegram sauvegardé", C.GREEN)
        input("↩️ Appuyez sur Entrée...")
        clear()
    except:
        log("❌ Erreur données Telegram", C.RED)
        input("↩️ Appuyez sur Entrée...")
        clear()

def instagram_menu():
    while True:
        banner()
        log("\n📸 INSTAGRAM", C.CYAN)
        log("1️⃣ Lister", C.YELLOW)
        log("2️⃣ Ajouter", C.YELLOW)
        log("3️⃣ Supprimer", C.YELLOW)
        log("0️⃣ Retour", C.RED)
        c = input("👉 ").strip()

        if c == "1":
            if not IG_ACCOUNTS:
                log("Aucun compte", C.RED)
            else:
                for i, a in enumerate(IG_ACCOUNTS, 1):
                    log(f"{i}. {a['user']}")
            input("↩️ Appuyez sur Entrée pour revenir au menu...")
            clear()
        elif c == "2":
            username = input("Username : ").strip()
            password = input("Password : ").strip()

            if not username or not password:
                log("❌ Username ou mot de passe vide", C.RED)
                input("↩️ Appuyez sur Entrée...")
                clear()
                return
            if any(acc["user"].lower() == username.lower() for acc in IG_ACCOUNTS):
                log("⚠️ Ce compte existe déjà", C.YELLOW)
                input("↩️ Appuyez sur Entrée...")
                clear()
                return
            IG_ACCOUNTS.append({
                "user": username,
                "pass": password
            })
            save_json(IG_ACCOUNTS_FILE, IG_ACCOUNTS)
            log("✔ Compte ajouté", C.GREEN)
            input("↩️ Appuyez sur Entrée...")
            clear()

        
        elif c == "3":
            if not IG_ACCOUNTS:
                log("Aucun compte à supprimer", C.RED)
                input("↩️ Appuyez sur Entrée...")
                clear()
                continue

            for i, a in enumerate(IG_ACCOUNTS, 1):
                log(f"{i}. {a['user']}")
            try:
                idx = int(input("Numéro : ")) - 1
                removed = IG_ACCOUNTS.pop(idx)
                save_json(IG_ACCOUNTS_FILE, IG_ACCOUNTS)
                log(f"✔ Supprimé : {removed['user']}", C.GREEN)
                input("↩️ Appuyez sur Entrée...")
                clear()
            except:
                log("❌ Erreur suppression", C.RED)
                input("↩️ Appuyez sur Entrée...")
                clear()

        elif c == "0":
            return
def task_menu():
    global TASK_LIKE, TASK_FOLLOW, TASK_COMMENT

    clear()
    banner()
    log("🎯 Sélection des tâches", C.CYAN)
    log("1️⃣ Like", C.YELLOW)
    log("2️⃣ Follow", C.YELLOW)
    log("3️⃣ Commentaire", C.YELLOW)
    log("👉 Exemple: 1 ou 1,2 ou 1,2,3", C.CYAN)

    choice = input("Choix : ").replace(" ", "")
    TASK_LIKE = "1" in choice
    TASK_FOLLOW = "2" in choice
    TASK_COMMENT = "3" in choice

    if not (TASK_LIKE or TASK_FOLLOW or TASK_COMMENT):
        log("❌ Aucun type sélectionné", C.RED)
        input("↩️ Appuyez sur Entrée...")
        return False

    log("\n✔ Tâches activées :", C.GREEN)
    if TASK_LIKE: log("  • Like", C.GREEN)
    if TASK_FOLLOW: log("  • Follow", C.GREEN)
    if TASK_COMMENT: log("  • Commentaire", C.GREEN)

    input("\n↩️ Appuyez sur Entrée pour démarrer...")
    return True


# ================= IG =================
def ensure_dirs():
    os.makedirs(SESSION_DIR, exist_ok=True)

def get_ig(user, pwd):
    if user in ig_clients:
        return ig_clients[user]

    ensure_dirs()
    cl = Client()
    cl.delay_range = [3,6]
    cl.set_user_agent("Instagram 289.0.0.77.109 Android")
    session = f"{SESSION_DIR}/{user}.json"

    try:
        if os.path.exists(session):
            cl.load_settings(session)

        cl.login(user, pwd)
        cl.dump_settings(session)
        ig_clients[user] = cl
        log(f"[IG] Connecté {user}", C.GREEN)
        return cl
    except Exception as e:
        log(f"[IG] Login fail {user} : {e}", C.RED)
        return None

# ================= TASK UTILS =================
async def human_sleep():
    await asyncio.sleep(random.uniform(*HUMAN_DELAY))

def is_task_message(text: str) -> bool:
    return text.startswith("▪️ Link :") and "instagram.com" in text

def extract_link(text: str):
    m = re.search(r"https://www\.instagram\.com/[^\s\]]+", text)
    return m.group(0) if m else None

def extract_username(link: str):
    parts = link.rstrip("/").split("/")
    if len(parts) >= 4 and parts[3] not in ("p", "reel", "tv"):
        return parts[3]
    return None

# ================= IG ACTIONS =================
def get_user_id_safe(ig: Client, username: str):
    try:
        return ig.user_info_by_username(username).pk
    except:
        return None

def do_like(ig: Client, link: str) -> bool:
    try:
        ig.media_like(ig.media_pk_from_url(link))
        return True
    except Exception as e:
        log(f"[IG] LIKE ERROR : {e}", C.RED)
        return True

def do_follow(ig: Client, link: str) -> bool:
    username = extract_username(link)
    if not username:
        return True

    user_id = get_user_id_safe(ig, username)
    if not user_id:
        return True

    try:
        ig.user_follow(user_id)
        return True
    except Exception as e:
        log(f"[IG] FOLLOW ERROR : {e}", C.RED)
        return True

# ================= TELEGRAM FLOW =================
async def send_smm(cmd: str):
    global LAST_SENT_CMD, LAST_SENT_TIME, WAITING_SMM_RESPONSE

    await tg.send_message(BOT, cmd)

    LAST_SENT_CMD = cmd
    LAST_SENT_TIME = time.time()
    WAITING_SMM_RESPONSE = True


async def request_tasks(username: str):
    await send_smm("📝Tasks📝")
    await asyncio.sleep(1.5)
    await send_smm("Instagram")
    await asyncio.sleep(1.5)
    await send_smm(username)


async def switch_account():
    global ig_index, task_count
    if not IG_ACCOUNTS:
        return

    task_count = 0
    ig_index = (ig_index + 1) % len(IG_ACCOUNTS)
    acc = IG_ACCOUNTS[ig_index]
    log(f"\n🔁 Switch IG → {acc['user']}", C.CYAN)
    get_ig(acc["user"], acc["pass"])
    await asyncio.sleep(3)
    await request_tasks(acc["user"])

# ================= HANDLER =================
async def on_message(event):
    global manual_comment, task_count

    async with task_lock:
        text = (event.raw_text or "").strip()

        if "⭕️ Sorry" in text:
            log("[TG] Aucune tâche → attente puis switch", C.YELLOW)
            await asyncio.sleep(NO_TASK_DELAY)
            await switch_account()
            return

        if manual_comment:
            if is_task_message(text):
                manual_comment = False
            else:
                return

        if not is_task_message(text):
            return

        link = extract_link(text)
        acc = IG_ACCOUNTS[ig_index]
        ig = get_ig(acc["user"], acc["pass"])
        if not ig or not link:
            return

        if "Leave the comment" in text:
            if TASK_COMMENT:
                manual_comment = True  # commentaire manuel
                return
            else:
                await send_smm(SKIP_TEXT)
                await human_sleep()
                return


        if "Like the post" in text:
            if not TASK_LIKE:
                await send_smm(SKIP_TEXT)
                await human_sleep()
                return

            log(f"📌 {acc['user']} LIKE : {link}", C.YELLOW)
            if do_like(ig, link):
                await human_sleep()
                await send_smm(COMPLETED_TEXT)
                task_count += 1
                log("✔ Like OK", C.GREEN)

        elif "Follow the profile" in text:
            if not TASK_FOLLOW:
                await send_smm(SKIP_TEXT)
                await human_sleep()
                return

            log(f"📌 {acc['user']} FOLLOW : {link}", C.YELLOW)
            if do_follow(ig, link):
                await human_sleep()
                await send_smm(COMPLETED_TEXT)
                task_count += 1
                log("✔ Follow OK", C.GREEN)

        if task_count >= TASK_LIMIT:
            await switch_account()

async def smm_watchdog():
    global CURRENT_RETRY, WAITING_SMM_RESPONSE, LAST_SENT_TIME

    while True:
        await asyncio.sleep(5)

        if not WAITING_SMM_RESPONSE:
            continue

        elapsed = time.time() - LAST_SENT_TIME

        if elapsed >= SMM_TIMEOUT:
            if CURRENT_RETRY >= MAX_RETRY:
                log("⛔ SMM bloqué → switch compte", C.RED)
                CURRENT_RETRY = 0
                WAITING_SMM_RESPONSE = False
                await switch_account()
                continue

            CURRENT_RETRY += 1
            log(f"⚠️ Aucun retour SMM → relance ({CURRENT_RETRY}/{MAX_RETRY})", C.YELLOW)

            await tg.send_message(BOT, LAST_SENT_CMD)
            LAST_SENT_TIME = time.time()

# ================= MAIN =================
async def main():
    global tg
    clear()
    banner()

    while True:
        c = main_menu()

        if c == "1":
            clear()
            telegram_menu()

        elif c == "2":
            clear()
            instagram_menu()

        elif c == "3":
            clear()
            if not tg_config["API_ID"] or not IG_ACCOUNTS:
                log("❌ Configuration incomplète", C.RED)
                input("↩️ Appuyez sur Entrée...")
                clear()
                continue

            if not task_menu():
                continue

            tg = TelegramClient("smmking", tg_config["API_ID"], tg_config["API_HASH"])
            tg.add_event_handler(on_message, events.NewMessage(chats=BOT))
            await tg.start(phone=tg_config["PHONE"])
            log("✔ Telegram connecté", C.GREEN)
            asyncio.create_task(smm_watchdog())

            get_ig(IG_ACCOUNTS[0]["user"], IG_ACCOUNTS[0]["pass"])
            await request_tasks(IG_ACCOUNTS[0]["user"])

            await asyncio.Event().wait()


        elif c == "0":
            log("⛔ Arrêt", C.RED)
            break

if __name__ == "__main__":
    asyncio.run(main())
